@using StudentCourseManagement.Models.Batches
@model BatchRequestModel
<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>Batch Create Form</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="#">Batch</a></li>
                    <li class="breadcrumb-item active">Batch Create Form</li>
                </ol>
            </div>
        </div>
    </div><!-- /.container-fluid -->
</section>
<form class="shadow row d-flex justify-content-center" asp-action="CreateBatch" method="post">
    <div class="card-body col-md-6 col-sm-12">
        <div class="form-group">
            <label>Course</label>
            <select id="batchList" asp-for="CourseId" style="width: 100%;" class="is-invalid">
                <option></option>
            </select>
            <span asp-validation-for="CourseId" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label for="title">Title</label>
            <input type="text" class="form-control is-invalid" id="title" asp-for="Title" placeholder="Title">
            <span asp-validation-for="Title" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label for="description">Description</label>
            <input type="text" class="form-control is-invalid" id="description" asp-for="Description" placeholder="Description">
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label for="credithours">Credit Hours</label>
            <input type="number" class="form-control preventSign is-invalid" min="1" id="credithours" asp-for="CreditHour" placeholder="Credit Hours">
            <span asp-validation-for="CreditHour" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label for="capacity">Capacity</label>
            <input type="number" class="form-control preventSign is-invalid" min="1" id="capacity" asp-for="Capacity" placeholder="Capacity">
            <span asp-validation-for="Capacity" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label>Start Date:</label>
            <div class="input-group date" id="reservationdate" data-target-input="nearest">
                <input type="text" class="form-control datetimepicker-input is-invalid" asp-for="StartDate" data-target="#reservationdate">
                <div class="input-group-append" data-target="#reservationdate" data-toggle="datetimepicker">
                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                </div>
            </div>
            <span asp-validation-for="StartDate" class="text-danger"></span>
        </div>
        <div class="form-group d-flex justify-content-end">
            <div>
                <button type="reset" class="btn btn-secondary">Cancel</button>
            </div>
            <div class="ml-2">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </div>
    </div>

</form>
@if (ViewBag.Message != null)
{
    <!-- Modal -->
    <div class="modal fade" id="dialogModal" tabindex="-1" aria-labelledby="dialogModal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Create Course</h1>
                    <button type="button" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="modal-body">
                    @ViewBag.Message
                </div>
                <div class="modal-footer">
                    <button type="button" id="confirmRedirectBtn" class="btn btn-primary">OK</button>
                </div>
            </div>
        </div>
    </div>
}

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#batchList').select2({
                placeholder:"Choose Course",
                allowClear: true,
                type: 'GET',
                ajax:{
                    url:'/batch/GetCourseList',
                    dataType:'json',
                    processResults:function(data)
                    {
                        return{
                                    results:data.map(function(item)
                                    {
                                        return {id:item.id,text:item.courseTitle}
                                    })
                               }
                    }
                }
            })
        })

          $(document).ready(function () {
            var isSuccess = '@ViewBag.IsSuccess' === 'True';
            var hasMessage = '@ViewBag.Message' !== '';

            if (isSuccess && hasMessage) {
                $('#dialogModal').modal('show');
            }

            $('#confirmRedirectBtn').on('click', function () {
                if (isSuccess) {
                    window.location.href = '@Url.Action("getcourselist", "course")';
                }
            });

            $('#dialogModal').on('hidden.bs.modal', function () {
                if (isSuccess) {
                    window.location.href = '@Url.Action("getcourselist", "course")';
                }
            });
        });
    </script>
}
