@using StudentCourseManagement.Models.Courses
<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h2>Course List</h2>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="#">Course</a></li>
                    <li class="breadcrumb-item active">Course List</li>
                </ol>
            </div>
        </div>
    </div><!-- /.container-fluid -->
</section>
<section class="content">
    <div class="card">
        <div class="card-header">
            <button class="btn btn-primary btn-sm px-2 fw-bold" id="addButton"><i class="fa-solid fa-circle-plus"></i> Add</button>
        </div>
        <div class="card-body">
            <table id="courseTable" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Course Code</th>
                        <th>Course Title</th>
                        <th class="no-export">Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</section>


@section Scripts {
    <script>
        $(document).ready(function () {
                $('#courseTable').DataTable({
               dom: 'Bfrtip', // B = buttons, f = filter, r = processing, t = table, i = info, p = pagination
               buttons: [
                   {
                       extend: 'excelHtml5',
                       exportOptions: {
                           columns: ':not(.no-export)'
                       },
                       text: '<i class="fas fa-file-excel"></i> Export Excel',
                       className: 'btn btn-success btn-sm',
                       init: function (api, node, config) {
                           $(node).removeClass('dt-button');
                       },
                   },
                   {
                       extend: 'pdfHtml5',
                       exportOptions: {
                           columns: ':not(.no-export)'
                       },
                       text: '<i class="fas fa-file-pdf"></i> Export PDF',
                       className: 'btn btn-danger btn-sm',
                       init: function (api, node, config) {
                           $(node).removeClass('dt-button');
                       },
                   }
               ],
               "processing": true,
               "serverSide": true,
               "ajax": {
                   url: "/Course/GetList",
                   type: "POST",
                   dataSrc: function (json) {
                       return json.data; // <- Make sure this matches the shape of your JSON
                   }
               },
               "columns": [
                   { "data": "courseCode" },
                   { "data": "courseTitle" },
                   {
                       data: 'id', // assuming each row has a unique ID
                       width: '20%',
                       render: function (data, type, row) {
                           return `
                               <div class="d-flex justify-content-center">
                                   <a href="/Course/Edit/${data}" class="btn btn-sm btn-primary mr-2" data-toggle="tooltip" title="Edit">
                                       <i class="fa-solid fa-pen-to-square"></i>
                                   </a>
                                   <a onclick="deleteCourse(${data})" class="btn btn-sm btn-danger" data-toggle="tooltip" title="Delete">
                                       <i class="fa-solid fa-trash"></i>
                                   </a>
                               </div>
                           `;
                       },
                       orderable: false,
                       searchable: false
                   }
               ]

           })
             $('#addButton').on('click', function () {
                 window.location.href="/course/createCourse";

             });
           })

               function deleteCourse(id) {
            if (confirm("Are you sure you want to delete this course?")) {
                $.ajax({
                    url: `/Course/Delete/${id}`,
                    type: 'GET',
                    success: function (result) {
                        alert('Success deleting course.');
                        $('#courseTable').DataTable().ajax.reload(); // Refresh table
                    },
                    error: function () {
                        alert('Error deleting course.');
                    }
                });
            }
        }


    </script>
}
